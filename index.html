<!DOCTYPE html>
<html lang="tr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>İnteraktif Proje Dokümanı - Kripto Alım Satım Botu</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
    <!-- Chosen Palette: Calm Tech (Base: #fcf9f4, Text: #3D405B, Accents: #81B29A, #F2CC8F, #E07A5F) -->
    <!-- Application Structure Plan: The SPA is structured as an interactive dashboard with five main tabs: Genel Bakış, Mimari & Akış, Teknik Detaylar, Proje Yönetimi, and Kullanıcı Deneyimi. This non-linear, thematic structure was chosen over a simple document layout to allow users (like project stakeholders or developers) to quickly navigate to the section most relevant to them. For example, a developer can jump directly to 'Teknik Detaylar' for API function lists, while a project manager can focus on 'Proje Yönetimi' for the task breakdown. This enhances usability by organizing a dense project plan into logical, manageable, and interactive sections. -->
    <!-- Visualization & Content Choices:
        - Proje Mimarisi (Architecture): Report Info: Textual description of components. -> Goal: Organize & Inform. -> Viz/Presentation: Interactive flowchart using styled HTML/CSS divs and flexbox. -> Interaction: Hovering over a component reveals a tooltip with a brief description. -> Justification: A visual diagram is far more intuitive for understanding system architecture than plain text. -> Library/Method: HTML/Tailwind CSS.
        - Proje Görev Listesi (Task List): Report Info: A long, linear list of tasks. -> Goal: Compare & Analyze. -> Viz/Presentation: A categorized list paired with a Chart.js Bar Chart showing task count per category. -> Interaction: The list is static, but the chart provides a quick visual summary of the project's workload distribution. -> Justification: The chart adds an analytical layer, making it easy to see where the bulk of the work lies (e.g., "Binance Entegrasyonu"). -> Library/Method: Chart.js/Canvas.
        - JSON Şemaları (JSON Schemas): Report Info: Code blocks for JSON. -> Goal: Inform & Organize. -> Viz/Presentation: Presented in collapsible accordion sections. -> Interaction: Clicking a section header expands/collapses the content. -> Justification: This prevents the 'Teknik Detaylar' section from being overwhelmingly long on initial load, improving scannability. -> Library/Method: HTML/JS.
        - Telegram Arayüzü (Telegram UI): Report Info: A simple table describing the UI. -> Goal: Inform & Visualize. -> Viz/Presentation: A realistic mockup of a mobile phone screen showing the Telegram interface. -> Interaction: None, it's a static visual aid. -> Justification: A visual mockup is more effective and immediate for communicating UI design than a descriptive table. -> Library/Method: HTML/Tailwind CSS.
        - Bilgisayar Arayüzü Önizlemesi (Desktop UI Preview): Report Info: High-level desktop UI design. -> Goal: Inform & Visualize. -> Viz/Presentation: A static HTML/CSS mockup of a desktop dashboard. -> Interaction: None, it's a static visual aid. -> Justification: Provides a clear understanding of the planned desktop interface structure and layout. -> Library/Method: HTML/Tailwind CSS. -->
    <!-- CONFIRMATION: NO SVG graphics used. NO Mermaid JS used. -->
    <style>
        body {
            font-family: 'Inter', sans-serif;
            background-color: #fcf9f4;
            color: #3D405B;
        }
        .tab-button {
            transition: all 0.3s ease;
        }
        .tab-button.active {
            border-color: #E07A5F;
            color: #E07A5F;
            background-color: #fcf9f4;
        }
        .tab-content {
            display: none;
        }
        .tab-content.active {
            display: block;
        }
        .accordion-content {
            max-height: 0;
            overflow: hidden;
            transition: max-height 0.5s ease-in-out;
        }
        .chart-container {
            position: relative;
            width: 100%;
            max-width: 800px;
            margin-left: auto;
            margin-right: auto;
            height: 350px;
            max-height: 400px;
        }
        @media (min-width: 768px) {
            .chart-container {
                height: 400px;
            }
        }
        .flow-arrow {
            position: absolute;
            width: 2px;
            background-color: #81B29A;
            z-index: 0;
        }
        .flow-arrow.right {
             top: 50%;
             left: 100%;
             height: 2px;
             width: 40px;
             transform: translateY(-50%);
        }
         .flow-arrow.down {
             top: 100%;
             left: 50%;
             width: 2px;
             height: 40px;
             transform: translateX(-50%);
        }
    </style>
</head>
<body class="antialiased">
    <div class="container mx-auto p-4 md:p-8">
        <header class="text-center mb-10">
            <h1 class="text-4xl md:text-5xl font-bold text-[#3D405B] tracking-tight">Kripto Para Alım Satım Botu</h1>
            <p class="text-lg text-gray-600 mt-2">İnteraktif Proje Dokümanı</p>
        </header>

        <nav class="flex flex-wrap justify-center border-b-2 border-gray-200 mb-8">
            <button class="tab-button text-sm md:text-base py-3 px-4 md:px-6 font-semibold text-gray-500 border-b-4 border-transparent hover:border-gray-300 hover:text-gray-700 focus:outline-none active" data-tab="tab1">Genel Bakış</button>
            <button class="tab-button text-sm md:text-base py-3 px-4 md:px-6 font-semibold text-gray-500 border-b-4 border-transparent hover:border-gray-300 hover:text-gray-700 focus:outline-none" data-tab="tab2">Mimari & Akış</button>
            <button class="tab-button text-sm md:text-base py-3 px-4 md:px-6 font-semibold text-gray-500 border-b-4 border-transparent hover:border-gray-300 hover:text-gray-700 focus:outline-none" data-tab="tab3">Teknik Detaylar</button>
            <button class="tab-button text-sm md:text-base py-3 px-4 md:px-6 font-semibold text-gray-500 border-b-4 border-transparent hover:border-gray-300 hover:text-gray-700 focus:outline-none" data-tab="tab4">Proje Yönetimi</button>
            <button class="tab-button text-sm md:text-base py-3 px-4 md:px-6 font-semibold text-gray-500 border-b-4 border-transparent hover:border-gray-300 hover:text-gray-700 focus:outline-none" data-tab="tab5">Kullanıcı Deneyimi</button>
        </nav>

        <main>
            <!-- Tab 1: Genel Bakış -->
            <div id="tab1" class="tab-content active">
                <section class="animate-fade-in">
                    <h2 class="text-3xl font-bold mb-6 text-[#3D405B]">Proje Özeti</h2>
                    <div class="grid md:grid-cols-2 gap-6">
                        <div class="bg-white/50 p-6 rounded-xl shadow-md border border-gray-200">
                            <h3 class="font-bold text-xl text-[#81B29A] mb-2">Projenin Amacı</h3>
                            <p class="text-gray-700">Binance borsasında, Renko grafiklerine ve dinamik ATR değerlerine dayalı, otomatik bir alım satım botu geliştirmek. Bu bot, manuel müdahaleyi en aza indirerek, önceden tanımlanmış stratejilere göre Long/Short pozisyonları açıp yönetecek ve riskleri kontrol altında tutacaktır.</p>
                        </div>
                        <div class="bg-white/50 p-6 rounded-xl shadow-md border border-gray-200">
                            <h3 class="font-bold text-xl text-[#E07A5F] mb-2">Çözülen Problemler</h3>
                            <ul class="list-disc list-inside text-gray-700 space-y-1">
                                <li>Manuel takibin zorluğu ve zaman kaybı.</li>
                                <li>Duygusal karar verme eğilimi.</li>
                                <li>Anlık piyasa fırsatlarını kaçırma riski.</li>
                                <li>Karmaşık risk yönetiminin (SL/TP) zorluğu.</li>
                            </ul>
                        </div>
                    </div>
                    <div class="mt-8 bg-white/50 p-6 rounded-xl shadow-md border border-gray-200">
                        <h3 class="font-bold text-2xl text-[#3D405B] mb-3">Genel Vizyon</h3>
                        <p class="text-gray-700">Projenin vizyonu, Binance üzerinde kesintisiz çalışan, TradingView geleneksel Renko grafiğe uyumlu bir şekilde LONG/SHORT sinyaller üreten, bu sinyalleri işleyerek sembolde spot ya da future işlem gerçekleştiren ve Telegram üzerinden kolayca yönetilebilen, kullanıcı dostu ve güvenilir bir otomatik alım satım asistanı oluşturmaktır. Bu sistem, kullanıcının stratejisini 7/24 uygulayarak hem fırsatları değerlendirmeyi hem de riskleri minimize etmeyi amaçlar.</p>
                    </div>
                </section>
            </div>

            <!-- Tab 2: Mimari & Akış -->
            <div id="tab2" class="tab-content">
                <section class="animate-fade-in">
                    <h2 class="text-3xl font-bold mb-6 text-[#3D405B]">Sistem Mimarisi ve Veri Akışı</h2>
                    <p class="mb-8 text-gray-600 max-w-3xl mx-auto text-center">Bu diyagram, projenin ana bileşenleri arasındaki etkileşimi ve veri akışını göstermektedir. Her bir bileşen, sistemin otonom çalışması için kritik bir rol oynar. Bileşenlerin üzerine gelerek daha fazla bilgi alabilirsiniz.</p>
                    <div class="flex flex-col md:flex-row justify-center items-center gap-y-10 md:gap-x-10 text-center text-sm font-semibold">
                        <div class="relative group p-6 bg-white rounded-xl shadow-lg border-2 border-[#81B29A]">
                            <span class="text-lg">📊</span>
                            <h4 class="mt-2 text-[#3D405B]">TradingView</h4>
                            <div class="absolute -bottom-12 left-1/2 -translate-x-1/2 w-48 bg-gray-800 text-white text-xs rounded py-2 px-3 opacity-0 group-hover:opacity-100 transition-opacity pointer-events-none">
                                Renko tuğla kapanışında (Yeşil/Kırmızı) sinyal üretir ve Webhook ile botun sunucusuna gönderir.
                            </div>
                        </div>
                        <div class="text-3xl text-[#81B29A] font-mono">&rarr;</div>
                        <div class="relative group p-6 bg-white rounded-xl shadow-lg border-2 border-[#F2CC8F]">
                            <span class="text-lg">🤖</span>
                            <h4 class="mt-2 text-[#3D405B]">Bot Çekirdeği (Sunucu)</h4>
                            <div class="absolute -bottom-20 left-1/2 -translate-x-1/2 w-64 bg-gray-800 text-white text-xs rounded py-2 px-3 opacity-0 group-hover:opacity-100 transition-opacity pointer-events-none">
                                Gelen sinyali işler, Binance'den ek veri çeker, Renko/ATR hesaplamalarını yapar, stratejiyi uygular ve tüm emir yönetimini koordine eder.
                            </div>
                        </div>
                        <div class="flex flex-col items-center gap-y-2">
                             <div class="text-3xl text-[#F2CC8F] font-mono transform rotate-90 md:rotate-0">&harr;</div>
                        </div>
                        <div class="flex flex-col gap-y-10">
                            <div class="relative group p-6 bg-white rounded-xl shadow-lg border-2 border-[#E07A5F]">
                                <span class="text-lg">💰</span>
                                <h4 class="mt-2 text-[#3D405B]">Binance API</h4>
                                 <div class="absolute -bottom-16 left-1/2 -translate-x-1/2 w-56 bg-gray-800 text-white text-xs rounded py-2 px-3 opacity-0 group-hover:opacity-100 transition-opacity pointer-events-none">
                                    Piyasa verisi sağlar, pozisyon aç/kapatır, SL/TP emirlerini yerleştirir ve bakiye bilgilerini günceller.
                                </div>
                            </div>
                            <div class="relative group p-6 bg-white rounded-xl shadow-lg border-2 border-blue-400">
                                <span class="text-lg">📱</span>
                                <h4 class="mt-2 text-[#3D405B]">Telegram API</h4>
                                 <div class="absolute -bottom-16 left-1/2 -translate-x-1/2 w-56 bg-gray-800 text-white text-xs rounded py-2 px-3 opacity-0 group-hover:opacity-100 transition-opacity pointer-events-none">
                                    Kullanıcıya bildirim gönderir, komutları alır ve botun uzaktan yönetilmesini sağlar.
                                </div>
                            </div>
                        </div>
                    </div>

                    <h3 class="text-2xl font-bold mt-16 mb-4 text-center text-[#3D405B]">Temel İşlem Mantığı (Sözde Kod)</h3>
                    <div class="max-w-4xl mx-auto bg-gray-800 text-white p-6 rounded-lg shadow-lg font-mono text-sm overflow-x-auto">
                        <pre><code>BAŞLA

    // Global Değişkenler ve Ayarlar
    AYARLAR = YükleAyarlar() // settings.json dosyasından veya ortam değişkenlerinden yükle
    MEVCUT_POZISYON_TIPI = AYARLAR.strateji_parametreleri.current_position_type // "LONG", "SHORT", "YOK"
    SON_KAPANAN_TUG_FIYAT = AYARLAR.strateji_parametreleri.last_processed_brick_close_price
    ATR_DEGERI = AYARLAR.strateji_parametreleri.current_atr_value

    // Binance API Bağlantısı
    BINANCE_CLIENT = BinanceClientBaslat(AYARLAR.api_credentials.binance_api_key, AYARLAR.api_credentials.binance_secret_key)
    BINANCE_CLIENT.KaldıracAyarla(AYARLAR.general.current_coin_pair, AYARLAR.general.leverage_ratio)
    BINANCE_CLIENT.MarjinModuAyarla(AYARLAR.general.current_coin_pair, AYARLAR.general.margin_mode)

    // Telegram Bot Bağlantısı
    TELEGRAM_BOT_YONETICISI = TelegramBotBaslat(AYARLAR.api_credentials.telegram_bot_token)
    TELEGRAM_BOT_YONETICISI.KomutIsleyicileriKaydet()
    TELEGRAM_BOT_YONETICISI.WebhookDinleyicisiBaslat() // Gelen webhook istekleri için

    // Bot Durumunu Başlat
    BOT_AKTIF = AYARLAR.general.is_bot_active

    // Ana Bot Mantığı için Sonsuz Döngü
    DÖNGÜ_BAŞLA (BOT_AKTIF olduğu sürece):
        DENE:
            // 1. Binance'den Güncel Mum Verilerini Çek ve Renko/ATR Hesapla
            // TradingView'den ATR alınamadığı için bot içinde hesaplanacak
            GUNCEL_MUM_VERILERI = BINANCE_CLIENT.GetKlineData(AYARLAR.general.current_coin_pair, AYARLAR.general.renko_time_period, 500) // Son 500 mum verisini çek
            
            YENI_RENKO_SONUCU = RenkoTuglasiOlusturVeATRHesapla(GUNCEL_MUM_VERILERI, AYARLAR.general.renko_atr_period)
            YENI_TUG_KAPANIS_FIYAT = YENI_RENKO_SONUCU.kapanis_fiyati
            YENI_TUG_TIPI = YENI_RENKO_SONUCU.tipi // "YEŞİL" veya "KIRMIZI"
            HESAPLANAN_ATR_DEGERI = YENI_RENKO_SONUCU.atr_degeri

            // Sadece yeni bir tuğla oluştuysa ve kapanış fiyatı değiştiyse veya önemli bir ATR değişimi varsa devam et
            EĞER YENI_TUG_KAPANIS_FIYAT != SON_KAPANAN_TUG_FIYAT VEYA Abs(HESAPLANAN_ATR_DEGERI - ATR_DEGERI) > (ATR_DEGERI * 0.05): // %5'ten fazla ATR değişimi
                SON_KAPANAN_TUG_FIYAT = YENI_TUG_KAPANIS_FIYAT
                ATR_DEGERI = HESAPLANAN_ATR_DEGERI

                // Mevcut Açık SL ve PV Emirlerini İptal Et
                BINANCE_CLIENT.TumAcikEmirleriIptalEt(AYARLAR.general.current_coin_pair)
                TELEGRAM_BOT_YONETICISI.MesajGonder(AYARLAR.general.telegram_chat_id, "Mevcut bekleyen emirler iptal edildi.")

                // Yeni Stop Loss ve Pozisyon Değerlerini Hesapla
                FSM = ATR_DEGERI * AYARLAR.general.stop_loss_coefficient
                LSL = FormatFiyat(SON_KAPANAN_TUG_FIYAT - FSM, AYARLAR.general.price_precision)
                SSL = FormatFiyat(SON_KAPANAN_TUG_FIYAT + FSM, AYARLAR.general.price_precision)
                
                // NLPV ve NSPV hesaplaması, 2 ATR kuralına göre
                NLPV = FormatFiyat(SON_KAPANAN_TUG_FIYAT + (2 * ATR_DEGERI), AYARLAR.general.price_precision)
                NSPV = FormatFiyat(SON_KAPANAN_TUG_FIYAT - (2 * ATR_DEGERI), AYARLAR.general.price_precision)
                
                TELEGRAM_BOT_YONETICISI.MesajGonder(AYARLAR.general.telegram_chat_id,
                    "Yeni hesaplanan değerler:\n" +
                    $"LSL: {LSL}\n" +
                    $"SSL: {SSL}\n" +
                    $"NLPV: {NLPV}\n" +
                    $"NSPV: {NSPV}"
                )

                // 3. Stratejiyi Uygula: Yeni pozisyon açılışı ve emir güncellemeleri
                EĞER YENI_TUG_TIPI == "YEŞİL":
                    EĞER MEVCUT_POZISYON_TIPI != "LONG":
                        // Pozisyon yoksa veya Short ise, Long aç
                        BINANCE_CLIENT.PiyasaEmriGonder(AYARLAR.general.current_coin_pair, "BUY", AYARLAR.general.position_size_usdt, AYARLAR.general.leverage_ratio)
                        MEVCUT_POZISYON_TIPI = "LONG"
                        TELEGRAM_BOT_YONETICISI.MesajGonder(AYARLAR.general.telegram_chat_id, $"Long pozisyon açıldı: {AYARLAR.general.current_coin_pair}")
                    
                    // Long Pozisyon için SL ve PV Emirlerini Gönder/Güncelle
                    BINANCE_CLIENT.StopMarketEmriGonder(AYARLAR.general.current_coin_pair, "SELL", LSL, AYARLAR.general.position_size_usdt) // LSL emri
                    BINANCE_CLIENT.StopMarketEmriGonder(AYARLAR.general.current_coin_pair, "BUY", NLPV, AYARLAR.general.position_size_usdt) // Fiyat dönüp Long pozisyon açarsa (NLPV)
                    // Short pozisyon açılması için NSPV emri, farklı senaryolarda kullanılabilir, burada öncelikli olarak NLPV gönderiliyor
                
                YOKSA EĞER YENI_TUG_TIPI == "KIRMIZI":
                    EĞER MEVCUT_POZISYON_TIPI != "SHORT":
                        // Pozisyon yoksa veya Long ise, Short aç
                        BINANCE_CLIENT.PiyasaEmriGonder(AYARLAR.general.current_coin_pair, "SELL", AYARLAR.general.position_size_usdt, AYARLAR.general.leverage_ratio)
                        MEVCUT_POZISYON_TIPI = "SHORT"
                        TELEGRAM_BOT_YONETICISI.MesajGonder(AYARLAR.general.telegram_chat_id, $"Short pozisyon açıldı: {AYARLAR.general.current_coin_pair}")

                    // Short Pozisyon için SL ve PV Emirlerini Gönder/Güncelle
                    BINANCE_CLIENT.StopMarketEmriGonder(AYARLAR.general.current_coin_pair, "BUY", SSL, AYARLAR.general.position_size_usdt) // SSL emri
                    BINANCE_CLIENT.StopMarketEmriGonder(AYARLAR.general.current_coin_pair, "SELL", NSPV, AYARLAR.general.position_size_usdt) // Fiyat dönüp Short pozisyon açarsa (NSPV)
                    // Long pozisyon açılması için NLPV emri, farklı senaryolarda kullanılabilir, burada öncelikli olarak NSPV gönderiliyor
                
                // 4. Logla ve Ayarları Kaydet
                KaydetIslemLogu({
                    "zaman": SimdikiZaman(),
                    "tugla_tipi": YENI_TUG_TIPI,
                    "kapanis_fiyati": YENI_TUG_KAPANIS_FIYAT,
                    "atr_degeri": ATR_DEGERI,
                    "lsl": LSL,
                    "ssl": SSL,
                    "nlpv": NLPV,
                    "nspv": NSPV,
                    "mevcut_pozisyon": MEVCUT_POZISYON_TIPI
                })
                TELEGRAM_BOT_YONETICISI.MesajGonder(AYARLAR.general.telegram_chat_id, "İşlem loglandı.")

                // Ayarları Kaydet (Son durum bilgileri)
                AYARLAR.strateji_parametreleri.current_position_type = MEVCUT_POZISYON_TIPI
                AYARLAR.strateji_parametreleri.last_processed_brick_close_price = YENI_TUG_KAPANIS_FIYAT
                AYARLAR.strateji_parametreleri.current_atr_value = ATR_DEGERI
                AYARLAR.strateji_parametreleri.long_stop_loss = LSL
                AYARLAR.strateji_parametreleri.short_stop_loss = SSL
                AYARLAR.strateji_parametreleri.next_long_position_value = NLPV
                AYARLAR.strateji_parametreleri.next_short_position_value = NSPV
                KaydetAyarlar(AYARLAR)

            // 5. Pozisyon Kapanışı Takibi (SL Tetiklenmesi)
            MEVCUT_BINANCE_POZISYON_BILGISI = BINANCE_CLIENT.GetPositionInfo(AYARLAR.general.current_coin_pair)
            EĞER MEVCUT_BINANCE_POZISYON_BILGISI.miktar == 0 VE MEVCUT_POZISYON_TIPI != "YOK": // Pozisyon Binance'de kapandıysa
                TELEGRAM_BOT_YONETICISI.MesajGonder(AYARLAR.general.telegram_chat_id, $"Önceki {MEVCUT_POZISYON_TIPI} pozisyon SL ile kapandı.")
                KaydetIslemLogu({
                    "zaman": SimdikiZaman(),
                    "event_type": "POSITION_CLOSED_BY_SL",
                    "coin_pair": AYARLAR.general.current_coin_pair,
                    "position_type": MEVCUT_POZISYON_TIPI,
                    "close_price": MEVCUT_BINANCE_POZISYON_BILGISI.kapanis_fiyati // Binance'den gelen kapanış fiyatı
                })
                MEVCUT_POZISYON_TIPI = "YOK"
                // SL sonrası fiyatın geri dönme senaryosu için uygun emir gönderimi (Senaryo 4)
                EĞER MEVCUT_BINANCE_POZISYON_BILGISI.onceki_tip == "LONG":
                    BINANCE_CLIENT.StopMarketEmriGonder(AYARLAR.general.current_coin_pair, "BUY", AYARLAR.strateji_parametreleri.next_long_position_value, AYARLAR.general.position_size_usdt)
                    TELEGRAM_BOT_YONETICISI.MesajGonder(AYARLAR.general.telegram_chat_id, $"NLPV ({AYARLAR.strateji_parametreleri.next_long_position_value}) emri gönderildi.")
                YOKSA EĞER MEVCUT_BINANCE_POZISYON_BILGISI.onceki_tip == "SHORT":
                    BINANCE_CLIENT.StopMarketEmriGonder(AYARLAR.general.current_coin_pair, "SELL", AYARLAR.strateji_parametreleri.next_short_position_value, AYARLAR.general.position_size_usdt)
                    TELEGRAM_BOT_YONETICISI.MesajGonder(AYARLAR.general.telegram_chat_id, $"NSPV ({AYARLAR.strateji_parametreleri.next_short_position_value}) emri gönderildi.")
                
                KaydetAyarlar(AYARLAR) // Pozisyon tipi ve diğer parametreleri güncelle

            // 6. Telegram Komutlarını İşle (Ayrı bir thread veya non-blocking çağrı ile)
            TELEGRAM_BOT_YONETICISI.KomutlariIsle()

            // Kısa bir bekleme süresi
            Bekle(AYARLAR.general.data_fetch_interval_seconds)

        HARİÇ (Hata E):
            KaydetHataLogu({"zaman": SimdikiZaman(), "hata_tipi": E.tipi, "mesaj": E.mesaj, "detaylar": E.detaylar})
            TELEGRAM_BOT_YONETICISI.MesajGonder(AYARLAR.general.telegram_chat_id, $"Botta kritik hata oluştu: {E.mesaj}")
            Bekle(AYARLAR.general.error_retry_interval_seconds) // Hata durumunda daha uzun bekleme
            
    DÖNGÜ_SONU

SON

// Yardımcı Fonksiyonlar:

FONKSIYON YükleAyarlar():
    // settings.json dosyasından ayarları yükle. Dosya yoksa varsayılanları oluştur.
    // İlk kurulumda manual girilen değerleri (işlem çifti, büyüklük, kaldıraç vb.) buradan alır.
    DÖNÜŞ: ayar_objesi

FONKSIYON KaydetAyarlar(ayarlar):
    // Ayarları settings.json dosyasına kaydet.
    // Strateji parametrelerinin (son tuğla fiyatı, ATR, mevcut pozisyon, SL/PV değerleri) güncel kalmasını sağlar.
    DÖNÜŞ: yok

FONKSIYON RenkoTuglasiOlusturVeATRHesapla(mum_verileri, atr_periyodu):
    // Mum verilerini kullanarak Renko tuğlalarını oluşturan algoritmayı içerir.
    // Renko tuğla boyutu ATR değerine bağlı olarak belirlenir.
    // Fonksiyon aynı zamanda ATR değerini de hesaplar.
    // Son kapanan Renko tuğlasının kapanış fiyatını ve tipini ("YEŞİL" veya "KIRMIZI") döndürür.
    // ATR değerini de döndürür.
    
    // Geçmiş mum verilerinden True Range (TR) hesapla
    // TR = Max(High - Low, Abs(High - PreviousClose), Abs(Low - PreviousClose))
    // ATR = Ortalama(TR, periyot)

    // Renko tuğlası oluşum mantığı:
    // Eğer fiyat değişimi (Mevcut Kapanış - Son Tuğla Kapanış) > Renko Kutu Büyüklüğü (örn. ATR'ye bağlı) ise yeni tuğla oluşur.
    // Kutu Büyüklüğü = ATR * Renko_Faktorü (Manuel olarak belirlenebilir)
    
    // Örnek basitleştirilmiş hesaplama:
    // ATR = (Son_Kapanan_Tug_1 - Son_Kapanan_Tug_2) / (Tug_Tipi_Ayni_Ise_1_Degilse_0.5)

    DÖNÜŞ: {kapanis_fiyati, tipi, atr_degeri}

FONKSIYON FormatFiyat(fiyat, hassasiyet):
    // Binance'in fiyat ve miktar hassasiyetine uygun olarak sayıyı formatlar.
    // Örn: 0.02712345 -> 0.02712 (hassasiyet 5 ise)
    DÖNÜŞ: formatlanmış_fiyat

FONKSIYON SimdikiZaman():
    // Güncel zaman damgasını döndür.
    DÖNÜŞ: zaman_damgası

FONKSIYON KaydetIslemLogu(log_data):
    // trade_logs.json dosyasına işlem logu ekle.
    // Bu fonksiyon aynı zamanda transactions.json dosyasına da detaylı Binance işlem kayıtlarını (order id, fill price, quantity vb.) ekleyebilir.
    DÖNÜŞ: yok

FONKSIYON KaydetHataLogu(error_data):
    // error_logs.json dosyasına hata logu ekle.
    DÖNÜŞ: yok

FONKSIYON Bekle(saniye):
    // Belirtilen saniye kadar bekler.
    DÖNÜŞ: yok

FONKSIYON GetPositionInfo(symbol):
    // Binance'den mevcut pozisyon bilgilerini daha detaylı döndürür (miktar, giriş fiyatı, pnl, önceki pozisyon tipi)
    DÖNÜŞ: {miktar, giriş_fiyatı, pnl, onceki_tip, kapanis_fiyati}
</code></pre>
                    </div>

                    <h3 class="text-2xl font-bold mt-16 mb-4 text-center text-[#3D405B]">Yapılacaklar Listesi (Akış İçin)</h3>
                    <div class="max-w-4xl mx-auto bg-white/50 p-6 rounded-lg shadow-md border border-gray-200 text-gray-700">
                        <ul class="list-disc list-inside space-y-3">
                            <li>
                                <strong class="text-[#81B29A]">Bot Başlangıcı ve Ayarların Yüklenmesi:</strong>
                                <ul class="list-circle list-inside ml-4 mt-1 space-y-1 text-sm">
                                    <li>Bot başlatıldığında, `settings.json` dosyasından veya ortam değişkenlerinden tüm manuel giriş ayarları (işlem çifti, pozisyon büyüklüğü, kaldıraç, ATR periyodu, SL katsayısı) yüklenir.</li>
                                    <li>Binance ve Telegram API istemcileri başlatılır.</li>
                                    <li>Botun son pozisyon durumu ve son işlem gören tuğla bilgileri yüklenir.</li>
                                </ul>
                            </li>
                            <li>
                                <strong class="text-[#81B29A]">Sürekli Veri Takibi ve Hesaplama Döngüsü:</strong>
                                <ul class="list-circle list-inside ml-4 mt-1 space-y-1 text-sm">
                                    <li>Belirlenen aralıklarla (örn. 15 saniye) Binance'den güncel mum verileri çekilir.</li>
                                    <li>Çekilen mum verileri kullanılarak Renko tuğlaları oluşturulur ve son kapanan tuğlanın tipi (yeşil/kırmızı) ve kapanış fiyatı tespit edilir.</li>
                                    <li>Her yeni tuğla kapanışıyla birlikte ATR değeri (Average True Range) bot içinde dinamik olarak hesaplanır.</li>
                                    <li>ATR değerine bağlı olarak FSM (Fiyat Sapma Miktarı) hesaplanır: `FSM = ATR * SLK` (SLK: Stop Loss Katsayısı).</li>
                                </ul>
                            </li>
                            <li>
                                <strong class="text-[#81B29A]">Pozisyon ve Emir Yönetimi:</strong>
                                <ul class="list-circle list-inside ml-4 mt-1 space-y-1 text-sm">
                                    <li>Her yeni tuğla oluştuğunda, Binance'deki mevcut tüm STOP MARKET emirleri (SL ve PV emirleri) iptal edilir.</li>
                                    <li>Botun stratejisine ve mevcut pozisyon durumuna göre yeni hesaplanan LSL/SSL ve NLPV/NSPV değerleriyle Binance'e yeni STOP MARKET emirleri gönderilir.</li>
                                    <li>İlk pozisyon açılışında veya SL tetiklenmesiyle kapanan pozisyonun ardından, uygun yönde (Long/Short) piyasa emri gönderilir.</li>
                                </ul>
                            </li>
                            <li>
                                <strong class="text-[#81B29A]">Sürekli Pozisyon ve Emir Kontrolü:</strong>
                                <ul class="list-circle list-inside ml-4 mt-1 space-y-1 text-sm">
                                    <li>Binance hesabındaki açık pozisyonlar ve bekleyen emirler sürekli olarak kontrol edilir.</li>
                                    <li>Stop Loss emirlerinin tetiklenip tetiklenmediği anlık olarak takip edilir.</li>
                                    <li>Bir pozisyon SL ile kapandığında, fiyatın tersine dönme senaryosu için ilgili NLPV veya NSPV emri anında gönderilir.</li>
                                </ul>
                            </li>
                            <li>
                                <strong class="text-[#81B29A]">Loglama ve Bildirimler:</strong>
                                <ul class="list-circle list-inside ml-4 mt-1 space-y-1 text-sm">
                                    <li>Tüm pozisyon açılışları, kapanışları, SL tetiklenmeleri ve emir güncellemeleri detaylı olarak `trade_logs.json` dosyasına kaydedilir.</li>
                                    <li>Sistemde meydana gelen hatalar `error_logs.json` dosyasına kaydedilir.</li>
                                    <li>Tüm kritik olaylar (pozisyon açılışı, kapanışı, hata) Telegram üzerinden kullanıcıya anlık bildirim olarak gönderilir.</li>
                                </ul>
                            </li>
                            <li>
                                <strong class="text-[#81B29A]">Kullanıcı Etkileşimi:</strong>
                                <ul class="list-circle list-inside ml-4 mt-1 space-y-1 text-sm">
                                    <li>Telegram botu üzerinden gelen komutlar (örn. `/status`, `/settings`, `/start_bot`, `/stop_bot`) işlenir ve ilgili bot aksiyonları tetiklenir.</li>
                                    <li>Bot ayarlarında manuel bir değişiklik yapıldığında (Telegram veya web arayüzü üzerinden), bot durdurulur, ayarlar güncellenir ve bot yeni ayarlarla yeniden başlatılır, tüm parametreler ve emirler yeniden hesaplanıp güncellenir.</li>
                                </ul>
                            </li>
                        </ul>
                    </div>

                    <h3 class="text-2xl font-bold mt-16 mb-4 text-center text-[#3D405B]">Hesaplama Detayları</h3>
                    <div class="max-w-4xl mx-auto bg-white/50 p-6 rounded-lg shadow-md border border-gray-200 text-gray-700">
                        <ul class="list-disc list-inside space-y-3">
                            <li>
                                <strong class="text-[#E07A5F]">ATR (Average True Range) Hesaplaması:</strong>
                                <p class="text-sm">ATR, fiyat oynaklığını ölçen bir göstergedir. Bot, Renko tuğla kapanışlarını kullanarak ATR değerini hesaplar. Temel olarak, aynı renkli iki ardışık Renko tuğlasının kapanış fiyatları arasındaki fark olarak alınır.</p>
                                <ul class="list-circle list-inside ml-4 mt-1 space-y-1 text-sm">
                                    <li>Long Tuğlalar İçin: `ATR = |Son Long Tuğla 1 Kapanış Değeri - Son Long Tuğla 2 Kapanış Değeri|`</li>
                                    <li>Short Tuğlalar İçin: `ATR = |Son Short Tuğla 1 Kapanış Değeri - Son Short Tuğla 2 Kapanış Değeri|`</li>
                                    <li>**Not:** Dokümanlarda karşıt tuğlaların farkının `2 * ATR` olarak yaklaşık bir değer verebileceği de belirtilmiştir, ancak ana ATR hesaplaması aynı renkli tuğlalar üzerinden yapılacaktır.</li>
                                </ul>
                            </li>
                            <li>
                                <strong class="text-[#E07A5F]">FSM (Fiyat Sapma Miktarı) Hesaplaması:</strong>
                                <p class="text-sm">FSM, stop loss seviyelerinin belirlenmesinde kullanılan, ATR değerine bağımlı bir sapma miktarıdır.</p>
                                <ul class="list-circle list-inside ml-4 mt-1 space-y-1 text-sm">
                                    <li>`FSM = ATR * SLK`</li>
                                    <li>`SLK` (Stop Loss Katsayısı) manuel olarak girilebilen, yüzdesel bir ifadedir (örn. `1.5`, `2.0`).</li>
                                </ul>
                            </li>
                            <li>
                                <strong class="text-[#E07A5F]">STOP LOSS (SL) Hesaplamaları:</strong>
                                <p class="text-sm">Pozisyonu riskten korumak için belirlenen fiyat seviyeleridir.</p>
                                <ul class="list-circle list-inside ml-4 mt-1 space-y-1 text-sm">
                                    <li>**LSL (Long Stop Loss):** Long pozisyonda iken fiyatın düşerek pozisyonu kapatacağı seviye.
                                        `LSL = Long Pozisyon Açılış Fiyatı - FSM` veya `LSL = Son Long Tuğla Kapanış Fiyatı - FSM` (Mevcut pozisyonda SL güncellemesi için)
                                    </li>
                                    <li>**SSL (Short Stop Loss):** Short pozisyonda iken fiyatın yükselerek pozisyonu kapatacağı seviye.
                                        `SSL = Short Pozisyon Açılış Fiyatı + FSM` veya `SSL = Son Short Tuğla Kapanış Fiyatı + FSM` (Mevcut pozisyonda SL güncellemesi için)
                                    </li>
                                    <li>**Ondalık Hassasiyet:** Stop Loss değerleri için en az 4-5 ondalık basamak hassasiyeti kullanılacaktır.</li>
                                </ul>
                            </li>
                            <li>
                                <strong class="text-[#E07A5F]">NLPV (Next Long Position Value) Hesaplaması:</strong>
                                <p class="text-sm">Bir Short pozisyonun SL ile kapanması durumunda, fiyatın tersine dönüp yeni bir Long pozisyon açılacağı seviyedir.</p>
                                <ul class="list-circle list-inside ml-4 mt-1 space-y-1 text-sm">
                                    <li>`NLPV = Son Kapanan Tuğla Kapanış Fiyatı + (2 * ATR)`</li>
                                </ul>
                            </li>
                            <li>
                                <strong class="text-[#E07A5F]">NSPV (Next Short Position Value) Hesaplaması:</strong>
                                <p class="text-sm">Bir Long pozisyonun SL ile kapanması durumunda, fiyatın tersine dönüp yeni bir Short pozisyon açılacağı seviyedir.</p>
                                <ul class="list-circle list-inside ml-4 mt-1 space-y-1 text-sm">
                                    <li>`NSPV = Son Kapanan Tuğla Kapanış Fiyatı - (2 * ATR)`</li>
                                </ul>
                            </li>
                        </ul>
                    </div>
                </section>
            </div>

            <!-- Tab 3: Teknik Detaylar -->
            <div id="tab3" class="tab-content">
                <section class="animate-fade-in">
                    <h2 class="text-3xl font-bold mb-6 text-[#3D405B]">Teknik Gereksinimler ve Veri Modeli</h2>
                    <div class="space-y-4">
                        <div class="accordion-item bg-white/50 border border-gray-200 rounded-lg shadow-sm">
                            <button class="accordion-header flex justify-between items-center w-full p-5 text-left font-semibold text-[#3D405B]">
                                <span>JSON Veri Tabanı Tasarımı</span>
                                <span class="transform transition-transform duration-300">▼</span>
                            </button>
                            <div class="accordion-content px-5">
                                <div class="py-4 grid md:grid-cols-2 gap-6">
                                    <div>
                                        <h4 class="font-bold text-lg mb-2 text-[#81B29A]">settings.json</h4>
                                        <p class="text-sm text-gray-600 mb-2">Botun genel, API ve strateji ayarlarını saklar. Bot yeniden başlatıldığında kaldığı yerden devam etmesini sağlar.</p>
                                        <pre class="bg-gray-800 text-white p-3 rounded-md text-xs overflow-x-auto"><code>{
  "setting": {
    "bot": {
      "telegram_bot_token": "GIZLIDIR",
      "telegram_dev_id": "7770286467",
      "telegram_user_id": "",
      "binance_key": "GIZLIDIR",
      "binance_secret": "GIZLIDIR",
      "tradingview_key": "GIZLIDIR",
      "host_ip": "localhost",
      "host_port": "5001",
      "long_message": "{'symbol': {{ticker}}, 'trend': LONG, 'price': {{ticker.price}}, 'key': bot21_OZERCAKIR}",
      "short_message": "{'symbol': {{ticker}}, 'trend': SHORT, 'price': {{ticker.price}}, 'key': bot21_OZERCAKIR}",
      "dev_web": "beydahsaglam.com",
      "dev_mail": "info.beydahsaglam@gmail.com",
      "dev_telegram_username": "@beydahsaglam"
    },
    "trade": {
      "default_atr": 14.0,
      "default_slc": 0.2,
      "default_atrr": 2.0,
      "default_limit": 15.0,
      "default_leverage": 1,
      "default_order_type": "future"
    },
    "order_types": {
     "future": "future",
     "market": "market"
    }
  }
}</code></pre>
                                    </div>
                                    <div>
                                        <h4 class="font-bold text-lg mb-2 text-[#E07A5F]">telegram.json</h4>
                                        <p class="text-sm text-gray-600 mb-2">Telegram botu ile ilgili mesaj, buton ve komut tanımlamalarını saklar.</p>
                                        <pre class="bg-gray-800 text-white p-3 rounded-md text-xs overflow-x-auto"><code>{
  "telegram": {
    "message": {
      "start": "Ben Ozer Binance Bot. Yapabilecegin islemleri gormek icin /menu /n",
      "info": "",
      "help": "Gelistiriciye ulasmak icin/nbeydahsaglam.com /n/menu /n",
      "menu": "Bot Menu/nBenimle asagidaki islemleri yapabilirsin./n",
      "exit": "Cikis Yapmak Icin /exit /n",
      "exited": "Cikis Yapildi /menu /n",
      "error": "Bir hata yaptim /menu /n",
      "alert": "Bir hata yaptiniz /menu /n",
      "success": "Islem basarili /menu /n",
      "denied": "Erisiminiz Yok/n",
      "unknown": "Ne dediginizi anlamadim /menu /n",
      "bot_start": "Trade Baslat/n",
      "bot_stop": "Trade Durdur/n",
      "settings": "Ayarlar/n",
      "logs": "Log Kayitlari/n"
    },
    "button": {
      "start_buttons": "BURAYA START BUTONU GELECEK YANI MENU",
      "menu_buttons": "BURAYA TUM ISLEMLERIN BUTONLARI GELECEK",
      "help_buttons": "BURAYA DEVELOPER WEBSITESI, MAILI, TELEGRAM KULLANICI ADI GELECEK",
      "get_order_buttons": "BURADA ISLEMI OLAN SEMBOLLER BUTON OLARAK GELECEK",
      "get_wallet_buttons": "BURADA WALLET'TAKI SEMBOLLERI GOR VE WALLET DEGISIMI GOR BUTONLARI GELECEK",
      "get_symbol_settings_buttons": "BURADA SYMBOL.JSON DOSYASINDAKI SEMBOLLER GELECEK VE BUNA BAGLI AYARLAR",
      "change_trade_settings_buttons": "BURADA SETTING.JSON DOSYASINDAKI TRADE AYARLARI BUTON OLARAK GELECEK",
      "change_symbol_settings_buttons": "BURADA SYMBOL.JSON DOSYASINDAKI SETTING AYARLARI BUTON OLARAK GELECEK",
      "webhook_buttons": "BURADA SETTING.JSON DOSYASINDAKI BOT AYARLARINA AIT WEB HOOK VE JSON MESAJLARI BUTON OLARAK GELECEK",
      "log_buttons": "BURADA HATA LOG GETIR, UYARI LOG GETIR, ISLEM LOG GETIR BUTONLARI OLACAK"
    },
    "command": {
      "start": "/start",
      "info": "/info",
      "help": "/help",
      "menu": "/menu",
      "exit": "/exit",
      "bot_start": "/bot_start",
      "bot_stop": "/bot_stop",
      "get_order": "/get_order",
      "get_wallet": "/get_wallet",
      "get_symbol_settings": "/get_symbol_settings",
      "change_symbol_settings": "/change_symbol_settings",
      "change_trade_settings": "/change_trade_settings",
      "get_log_error": "/get_log_error",
      "get_log_alert": "/get_log_alert",
      "get_log_transactions": "/get_log_transactions"
    }
  }
}</code></pre>
                                    </div>
                                    <div>
                                        <h4 class="font-bold text-lg mb-2 text-[#81B29A]">symbol.json</h4>
                                        <p class="text-sm text-gray-600 mb-2">Botun takip ettiği sembollerin trend, ayar ve cüzdan bilgilerini saklar.</p>
                                        <pre class="bg-gray-800 text-white p-3 rounded-md text-xs overflow-x-auto"><code>{
  "symbol": {
    "trend": {
      "SYMBOL": {
        "last_trend": "LONG",
        "new_trend": "LONG",
        "last_trend_datetime": "DATETIME",
        "new_trend_datetime": "DATETIME"
      }
    },
    "setting": {
      "SYMBOL": {
        "atr": 14.0,
        "slc": 0.2,
        "atrr": 2.0,
        "limit": 15.0,
        "leverage": 1,
        "order_type": "FUTURE"
      }
    },
    "wallet": {
      "balance": {
        "first_balance": 1000.0,
        "last_balance": 1500.0,
        "now_balance": 1000.0,
        "first_balance_date": "DATETIME",
        "last_balance_date": "DATETIME",
        "new_balance_date": "DATETIME"
      }
    }
  }
}</code></pre>
                                    </div>
                                    <div>
                                        <h4 class="font-bold text-lg mb-2 text-[#E07A5F]">log.json</h4>
                                        <p class="text-sm text-gray-600 mb-2">Genel log mesajlarını (hata, uyarı, işlem) saklar.</p>
                                        <pre class="bg-gray-800 text-white p-3 rounded-md text-xs overflow-x-auto"><code>{
  "log": {
    "DATETIME": {
      "error": {
        "title": "ERROR ORNEK",
        "text": "ORNEK HATA MESAJI"
      },
      "alert": {
        "title": "ALERT ORNEK",
        "text": "ORNEK UYARI MESAJI"
      },
      "transaction": {
        "title": "TRANSACTION ORNEK",
        "text": "ORNEK ISLEM MESAJI"
      }
    }
  }
}</code></pre>
                                    </div>
                                    <div>
                                        <h4 class="font-bold text-lg mb-2 text-[#81B29A]">order.json</h4>
                                        <p class="text-sm text-gray-600 mb-2">Örnek işlem siparişi detaylarını saklar.</p>
                                        <pre class="bg-gray-800 text-white p-3 rounded-md text-xs overflow-x-auto"><code>{
  "order": {
    "SYMBOL": {
      "DATETIME": {
        "event_type": "FUTURE_LONG",
        "entry_price": "1400.00",
        "renko_price": "1200.00",
        "coin_quantity": "20.00",
        "usdt_quantity": "15.00",
        "calc_atr": "14.00",
        "calc_stop_loss": "1300.00",
        "calc_reverse_position": "1200.00"
      }
    }
  }
}</code></pre>
                                    </div>
                                    <div>
                                        <h4 class="font-bold text-lg mb-2 text-[#E07A5F]">trade_logs.json</h4>
                                        <p class="text-sm text-gray-600 mb-2">Gerçekleşen tüm işlemlerin (pozisyon açılışı, kapanışı, SL tetiklenmesi vb.) geçmişini saklar.</p>
                                        <pre class="bg-gray-800 text-white p-3 rounded-md text-xs overflow-x-auto"><code>[
  {
    "timestamp": "2025-06-12T14:30:00Z",
    "event_type": "POSITION_OPENED",
    "coin_pair": "APTUSDT",
    "position_type": "LONG",
    "entry_price": 0.02710,
    "quantity": 36900.0,
    "position_size_usdt": 1000.0,
    "leverage": 2,
    "calculated_lsl": 0.02680,
    "calculated_nlpv": 0.02750,
    "calculated_nspv": 0.02660,
    "renko_brick_close": 0.02710,
    "atr_at_event": 0.00015,
    "message": "Long pozisyon açıldı."
  },
  {
    "timestamp": "2025-06-12T14:45:00Z",
    "event_type": "STOP_LOSS_TRIGGERED",
    "coin_pair": "APTUSDT",
    "position_type": "LONG",
    "close_price": 0.02685,
    "pnl_usdt": -10.0,
    "renko_brick_close": 0.02685,
    "atr_at_event": 0.00016,
    "message": "Long pozisyon LSL ile kapandı. Yeni NLPV emri gönderildi."
  },
  {
    "timestamp": "2025-06-12T15:00:00Z",
    "event_type": "BRICK_UPDATE",
    "coin_pair": "APTUSDT",
    "renko_brick_close": 0.02720,
    "atr_at_event": 0.00017,
    "new_lsl": 0.02690,
    "new_ssl": 0.02750,
    "new_nlpv": 0.02760,
    "new_nspv": 0.02680,
    "message": "Yeni yeşil tuğla oluştu. Stop emirleri güncellendi."
  }
]</code></pre>
                                    </div>
                                    <div>
                                        <h4 class="font-bold text-lg mb-2 text-[#81B29A]">error_logs.json</h4>
                                        <p class="text-sm text-gray-600 mb-2">Sistemde meydana gelen hataları saklar.</p>
                                        <pre class="bg-gray-800 text-white p-3 rounded-md text-xs overflow-x-auto"><code>[
  {
    "timestamp": "2025-06-12T14:05:00Z",
    "error_type": "BINANCE_API_ERROR",
    "message": "Binance API bağlantı hatası: [API Hata Kodu] - [Açıklama]",
    "details": "İşlem: Emir gönderme, Parametreler: { 'symbol': 'APTUSDT', 'side': 'BUY' }"
  }
]</code></pre>
                                    </div>
                                    <div>
                                        <h4 class="font-bold text-lg mb-2 text-[#E07A5F]">following_symbols.json</h4>
                                        <p class="text-sm text-gray-600 mb-2">Botun aktif olarak takip ettiği ve işlem yaptığı sembollerin listesini ve her sembole özgü ayarları saklar.</p>
                                        <pre class="bg-gray-800 text-white p-3 rounded-md text-xs overflow-x-auto"><code>[
  {
    "symbol": "APTUSDT",
    "is_active": true,
    "renko_time_period": "15m",
    "atr_period": 14,
    "stop_loss_coefficient": 1.5,
    "position_size_usdt": 1000.0,
    "leverage_ratio": 2,
    "margin_mode": "ISOLATED",
    "last_processed_brick": {
      "close_price": 0.02710,
      "type": "GREEN",
      "timestamp": "2025-06-12T15:00:00Z"
    }
  }
]</code></pre>
                                    </div>
                                    <div>
                                        <h4 class="font-bold text-lg mb-2 text-[#81B29A]">transactions.json</h4>
                                        <p class="text-sm text-gray-600 mb-2">Binance üzerinde gerçekleşen her bir emir ve işlem detayını (daha granüler seviyede) saklar.</p>
                                        <pre class="bg-gray-800 text-white p-3 rounded-md text-xs overflow-x-auto"><code>[
  {
    "timestamp": "2025-06-12T14:30:05Z",
    "order_id": "123456789",
    "client_order_id": "bot_order_APTUSDT_1",
    "symbol": "APTUSDT",
    "side": "BUY",
    "type": "MARKET",
    "status": "FILLED",
    "executed_price": 0.02710,
    "executed_qty": 36900.0,
    "commission": 0.00000738,
    "commission_asset": "BNB",
    "realized_pnl": 0.0,
    "transaction_type": "POSITION_ENTRY"
  }
]</code></pre>
                                    </div>
                                    <div>
                                        <h4 class="font-bold text-lg mb-2 text-[#E07A5F]">wallet_changes.json</h4>
                                        <p class="text-sm text-gray-600 mb-2">Cüzdan bakiyesindeki değişiklikleri ve tarihçesini takip eder, PnL (Kar/Zarar) takibi için kullanılabilir.</p>
                                        <pre class="bg-gray-800 text-white p-3 rounded-md text-xs overflow-x-auto"><code>[
  {
    "timestamp": "2025-06-12T14:00:00Z",
    "event_type": "INITIAL_BALANCE",
    "asset": "USDT",
    "total_balance": 1000.0,
    "available_balance": 1000.0,
    "change_amount": 0.0,
    "notes": "Bot başlatıldı, başlangıç bakiyesi"
  },
  {
    "timestamp": "2025-06-12T14:30:05Z",
    "event_type": "POSITION_OPENED",
    "asset": "USDT",
    "total_balance": 1000.0,
    "available_balance": 999.0,
    "change_amount": -1.0,
    "notes": "Long pozisyon açılışı, marjin kullanımı"
  },
  {
    "timestamp": "2025-06-12T14:45:10Z",
    "event_type": "POSITION_CLOSED",
    "asset": "USDT",
    "total_balance": 990.0,
    "available_balance": 990.0,
    "change_amount": -10.0,
    "notes": "Long pozisyon SL ile kapandı, PnL: -10 USDT"
  }
]</code></pre>
                                    </div>
                                </div>
                            </div>
                        </div>

                        <div class="accordion-item bg-white/50 border border-gray-200 rounded-lg shadow-sm">
                            <button class="accordion-header flex justify-between items-center w-full p-5 text-left font-semibold text-[#3D405B]">
                                <span>TradingView Webhook JSON Formatı</span>
                                <span class="transform transition-transform duration-300">▼</span>
                            </button>
                            <div class="accordion-content px-5">
                                <div class="py-4">
                                    <p class="text-sm text-gray-600 mb-2">TradingView'den botun Webhook dinleyicisine gönderilecek sinyal mesajının yapısı:</p>
                                    <pre class="bg-gray-800 text-white p-3 rounded-md text-xs overflow-x-auto"><code>{
  "symbol": "APTUSDT",         // İşlem çifti (örn. ETHUSDT, BTCUSDT)
  "close_price": 0.02715,     // Tuğlanın kapanış fiyatı
  "direction": "LONG",        // Sinyal yönü: "LONG" (yeşil tuğla) veya "SHORT" (kırmızı tuğla)
  "timestamp": "2025-06-12T15:00:00Z", // Sinyalin oluştuğu zaman damgası
  "strategy_name": "RenkoATR", // Strateji adı (isteğe bağlı)
  "alert_id": "my_renko_alert_1" // TradingView alarm ID'si (isteğe bağlı)
}</code></pre>
                                </div>
                            </div>
                        </div>

                        <div class="accordion-item bg-white/50 border border-gray-200 rounded-lg shadow-sm">
                            <button class="accordion-header flex justify-between items-center w-full p-5 text-left font-semibold text-[#3D405B]">
                                <span>Binance API Fonksiyonları</span>
                                <span class="transform transition-transform duration-300">▼</span>
                            </button>
                            <div class="accordion-content px-5">
                                <ul class="list-disc list-inside py-4 text-gray-700 space-y-2">
                                    <li><code class="bg-gray-200 p-1 rounded">initialize_binance_client(api_key, secret_key)</code>: Binance API istemcisini başlatır.</li>
                                    <li><code class="bg-gray-200 p-1 rounded">get_server_time()</code>: Binance sunucu saatini alır.</li>
                                    <li><code class="bg-gray-200 p-1 rounded">get_exchange_info(symbol=None)</code>: Sembol bilgileri (hassasiyet) alır.</li>
                                    <li><code class="bg-gray-200 p-1 rounded">get_kline_data(symbol, interval, limit=500)</code>: Renko ve ATR hesaplaması için mum verilerini çeker.</li>
                                    <li><code class="bg-gray-200 p-1 rounded">get_account_balance(asset=None)</code>: Cüzdan bakiyesini sorgular.</li>
                                    <li><code class="bg-gray-200 p-1 rounded">get_open_orders(symbol=None)</code>: Mevcut açık emirleri listeler.</li>
                                    <li><code class="bg-gray-200 p-1 rounded">get_position_info(symbol=None)</code>: Mevcut pozisyon bilgilerini alır.</li>
                                    <li><code class="bg-gray-200 p-1 rounded">place_market_order(symbol, side, quantity_usdt, options=None)</code>: Pozisyon açmak için piyasa emri gönderir.</li>
                                    <li><code class="bg-gray-200 p-1 rounded">place_stop_market_order(symbol, side, stop_price, quantity_usdt, options=None)</code>: SL, NLPV, NSPV emirlerini oluşturur.</li>
                                    <li><code class="bg-gray-200 p-1 rounded">cancel_all_open_orders(symbol)</code>: Emirleri güncellemeden önce mevcut emirleri iptal eder.</li>
                                    <li><code class="bg-gray-200 p-1 rounded">set_leverage(symbol, leverage)</code>: Kaldıraç oranını ayarlar.</li>
                                    <li><code class="bg-gray-200 p-1 rounded">set_margin_mode(symbol, margin_type)</code>: Marjin modunu ayarlar.</li>
                                    <li><code class="bg-gray-200 p-1 rounded">get_current_price(symbol)</code>: Anlık fiyatı alır.</li>
                                </ul>
                            </div>
                        </div>

                        <div class="accordion-item bg-white/50 border border-gray-200 rounded-lg shadow-sm">
                            <button class="accordion-header flex justify-between items-center w-full p-5 text-left font-semibold text-[#3D405B]">
                                <span>Telegram & TradingView Entegrasyon Fonksiyonları</span>
                                <span class="transform transition-transform duration-300">▼</span>
                            </button>
                            <div class="accordion-content px-5">
                               <div class="py-4 grid md:grid-cols-2 gap-6">
                                    <div>
                                        <h4 class="font-bold text-lg mb-2 text-blue-500">Telegram Bot</h4>
                                        <ul class="list-disc list-inside text-gray-700 space-y-2">
                                            <li><code class="bg-gray-200 p-1 rounded">initialize_telegram_bot(token)</code>: Telegram bot istemcisini başlatır.</li>
                                            <li><code class="bg-gray-200 p-1 rounded">send_message(chat_id, text)</code>: Kullanıcıya bildirim gönderir.</li>
                                            <li><code class="bg-gray-200 p-1 rounded">register_command_handlers()</code>: /start, /status gibi komutları tanımlar.</li>
                                            <li><code class="bg-gray-200 p-1 rounded">notify_position_opened()</code>: Pozisyon açılış bildirimi gönderir.</li>
                                            <li><code class="bg-gray-200 p-1 rounded">notify_position_closed()</code>: Pozisyon kapanış bildirimi gönderir.</li>
                                            <li><code class="bg-gray-200 p-1 rounded">notify_sl_updated()</code>: Stop Loss güncelleme bildirimi gönderir.</li>
                                            <li><code class="bg-gray-200 p-1 rounded">notify_error()</code>: Hata bildirimi gönderir.</li>
                                            <li><code class="bg-gray-200 p-1 rounded">create_inline_keyboard()</code>: Yönetim arayüzü için butonlar oluşturur.</li>
                                            <li><code class="bg-gray-200 p-1 rounded">handle_callback_query()</code>: Inline buton tıklamalarını işler.</li>
                                        </ul>
                                    </div>
                                    <div>
                                        <h4 class="font-bold text-lg mb-2 text-green-500">TradingView Webhook</h4>
                                         <ul class="list-disc list-inside text-gray-700 space-y-2">
                                            <li><code class="bg-gray-200 p-1 rounded">start_webhook_listener(host, port, secret_key)</code>: Gelen sinyalleri dinlemek için sunucu başlatır.</li>
                                            <li><code class="bg-gray-200 p-1 rounded">process_incoming_webhook_signal(request_data, headers)</code>: Gelen JSON sinyalini ayrıştırır.</li>
                                            <li><code class="bg-gray-200 p-1 rounded">validate_webhook_request(headers, secret_key)</code>: Gelen isteğin güvenliğini doğrular.</li>
                                            <li><code class="bg-gray-200 p-1 rounded">handle_tradingview_signal(signal_data)</code>: Sinyal verisini ana bot mantığına iletir.</li>
                                            <li><code class="bg-gray-200 p-1 rounded">log_received_signal(signal_data)</code>: Gelen sinyalleri loglar.</li>
                                        </ul>
                                    </div>
                               </div>
                            </div>
                        </div>

                    </div>
                </section>
            </div>

            <!-- Tab 4: Proje Yönetimi -->
            <div id="tab4" class="tab-content">
                <section class="animate-fade-in">
                    <h2 class="text-3xl font-bold mb-2 text-[#3D405B]">Proje Görev Listesi</h2>
                    <p class="mb-8 text-gray-600 text-center">Projenin geliştirme süreci, aşağıdaki ana kategorilere ayrılmış görevlerden oluşmaktadır.</p>
                     <div class="chart-container mb-12">
                        <canvas id="tasksChart"></canvas>
                    </div>
                    <div class="grid md:grid-cols-2 lg:grid-cols-3 gap-6">
                        <div class="bg-white/50 p-6 rounded-xl shadow-sm border border-gray-200">
                            <h4 class="font-bold text-lg mb-3">Yapılan Çalışmalar</h4>
                            <ul class="list-decimal list-inside text-gray-700 space-y-1 text-sm">
                                <li>Döküman Yazıldı</li>
                                <li>Veri Mimarisi Oluşturuldu</li>
                            </ul>
                        </div>
                        <div class="bg-white/50 p-6 rounded-xl shadow-sm border border-gray-200">
                            <h4 class="font-bold text-lg mb-3">Yapılacak Çalışmalar</h4>
                            <ul class="list-decimal list-inside text-gray-700 space-y-1 text-sm">
                                <li>Kod Mimarisi</li>
                                <li>Binance Hata Düzeltme</li>
                                <li>TradingView Hata Düzeltme</li>
                                <li>Telegram Hata Düzeltme</li>
                                <li>Arayüz Oluşturma</li>
                                <li>Pine Script Yazma</li>
                                <li>Kullanım Dökümanı Oluşturma</li>
                                <li>Sunucu Kiralama</li>
                                <li>Sunucu Kurulum</li>
                                <li>Kod Kurulum</li>
                                <li>Kullanım Eğitimi</li>
                            </ul>
                        </div>
                        <div class="bg-white/50 p-6 rounded-xl shadow-sm border border-gray-200">
                            <h4 class="font-bold text-lg mb-3">1. Altyapı ve Entegrasyonlar (Yüksek Öncelik)</h4>
                            <ul class="list-decimal list-inside text-gray-700 space-y-1 text-sm">
                                <li>Uzak sunucu kurulumu ve konfigürasyonu.</li>
                                <li>Gerekli Python kütüphanelerinin yüklenmesi.</li>
                                <li>Binance API anahtarlarının güvenli yönetimi.</li>
                                <li>Telegram botu oluşturma ve token konfigürasyonu.</li>
                                <li>TradingView için Webhook listener geliştirme.</li>
                            </ul>
                        </div>
                        <div class="bg-white/50 p-6 rounded-xl shadow-sm border border-gray-200">
                             <h4 class="font-bold text-lg mb-3">2. Çekirdek Mantık (Yüksek Öncelik)</h4>
                             <ul class="list-decimal list-inside text-gray-700 space-y-1 text-sm">
                                <li>Renko tuğlası oluşturma algoritması.</li>
                                <li>ATR hesaplama fonksiyonu.</li>
                                <li>SL ve PV değerlerini hesaplama fonksiyonu.</li>
                                <li>Pozisyon açma/kapama strateji mantığı.</li>
                                <li>Emir güncelleme (iptal et ve yeniden oluştur) mekanizması.</li>
                            </ul>
                        </div>
                         <div class="bg-white/50 p-6 rounded-xl shadow-sm border border-gray-200">
                             <h4 class="font-bold text-lg mb-3">3. Arayüz ve Kullanıcı Etkileşimi (Yüksek Öncelik)</h4>
                             <ul class="list-decimal list-inside text-gray-700 space-y-1 text-sm">
                                <li>Telegram komut işleyicilerinin geliştirilmesi (/start, /status vb.).</li>
                                <li>Telegram bildirim sisteminin oluşturulması.</li>
                                <li>Telegram inline butonlarının entegrasyonu.</li>
                                <li>Ayarları Telegram üzerinden değiştirme akışları.</li>
                            </ul>
                        </div>
                        <div class="bg-white/50 p-6 rounded-xl shadow-sm border border-gray-200">
                             <h4 class="font-bold text-lg mb-3">4. Veri Yönetimi ve Güvenlik (Yüksek Öncelik)</h4>
                              <ul class="list-decimal list-inside text-gray-700 space-y-1 text-sm">
                                <li>JSON veritabanı yapısının oluşturulması (settings, logs).</li>
                                <li>İşlem ve hata loglama fonksiyonları.</li>
                                <li>Kapsamlı hata yakalama (Try-Except).</li>
                                <li>Kullanıcı kimlik doğrulama (chat_id kontrolü).</li>
                            </ul>
                        </div>
                        <div class="bg-white/50 p-6 rounded-xl shadow-sm border border-gray-200">
                             <h4 class="font-bold text-lg mb-3">5. Test ve Optimizasyon (Orta Öncelik)</h4>
                              <ul class="list-decimal list-inside text-gray-700 space-y-1 text-sm">
                                <li>Birim ve entegrasyon testlerinin yapılması.</li>
                                <li>Binance Testnet veya küçük miktarlarla canlı testler.</li>
                                <li>Kod optimizasyonu ve performans iyileştirmeleri.</li>
                                <li>API hız sınırlarına uyumun sağlanması.</li>
                            </ul>
                        </div>
                        <div class="bg-white/50 p-6 rounded-xl shadow-sm border border-gray-200">
                             <h4 class="font-bold text-lg mb-3">6. Dokümantasyon (Düşük Öncelik)</h4>
                              <ul class="list-decimal list-inside text-gray-700 space-y-1 text-sm">
                                <li>Son kullanıcı için kurulum ve kullanım kılavuzu hazırlama.</li>
                                <li>Geliştirici dokümantasyonu (kod içi yorumlar).</li>
                            </ul>
                        </div>
                    </div>
                </section>
            </div>

            <!-- Tab 5: Kullanıcı Deneyimi -->
            <div id="tab5" class="tab-content">
                 <section class="animate-fade-in">
                    <h2 class="text-3xl font-bold mb-6 text-[#3D405B]">Kullanıcı Arayüzü Taslağı ve Kılavuz</h2>
                    <div class="grid md:grid-cols-2 gap-8 items-start">
                        <div>
                             <h3 class="text-2xl font-bold mb-4 text-[#3D405B]">Telegram Arayüzü Önizlemesi</h3>
                             <p class="text-gray-600 mb-6">Bot, kullanıcıyla tamamen Telegram üzerinden etkileşime girecektir. Aşağıda, ana menünün nasıl görüneceğine dair bir taslak yer almaktadır. Butonlar aracılığıyla tüm fonksiyonlara kolayca erişilebilir.</p>
                             <div class="w-full max-w-sm mx-auto bg-gray-200 rounded-3xl p-2 shadow-2xl">
                                <div class="bg-white rounded-2xl overflow-hidden">
                                    <div class="bg-gray-100 p-3 flex items-center justify-between border-b">
                                        <div class="flex items-center gap-2">
                                            <span class="w-10 h-10 bg-blue-500 rounded-full text-white flex items-center justify-center font-bold text-lg">ÖB</span>
                                            <div>
                                                <p class="font-semibold text-sm">Özer Binance Bot</p>
                                                <p class="text-xs text-gray-500">online</p>
                                            </div>
                                        </div>
                                    </div>
                                    <div class="p-4 space-y-3 bg-blue-50/30 h-96 overflow-y-auto">
                                        <div class="flex">
                                            <div class="bg-gray-200 p-3 rounded-lg max-w-xs">
                                                <p class="text-sm">Merhaba! Ben sizin Binance botunuzum. Şu anda aktif durumdayım. Nasıl yardımcı olabilirim?</p>
                                            </div>
                                        </div>
                                        <div class="flex justify-end">
                                            <div class="bg-blue-500 text-white p-3 rounded-lg max-w-xs">
                                                <p class="text-sm">/start</p>
                                            </div>
                                        </div>
                                         <div class="flex">
                                            <div class="bg-gray-200 p-3 rounded-lg max-w-xs">
                                                <p class="text-sm font-bold mb-2">📊 Ana Menü</p>
                                                <p class="text-xs mb-3">Durum: <span class="text-green-600 font-semibold">Aktif</span> | Bakiye: <span class="font-semibold">1000 USDT</span></p>
                                                <div class="grid grid-cols-2 gap-2 text-center text-sm">
                                                    <button class="bg-white p-2 rounded-md shadow-sm border">Botu Başlat</button>
                                                    <button class="bg-white p-2 rounded-md shadow-sm border">Botu Durdur</button>
                                                    <button class="bg-white p-2 rounded-md shadow-sm border">Pozisyon</button>
                                                    <button class="bg-white p-2 rounded-md shadow-sm border">Cüzdanım</button>
                                                    <button class="bg-white p-2 rounded-md shadow-sm border">Ayarlar</button>
                                                    <button class="bg-white p-2 rounded-md shadow-sm border">Loglar</button>
                                                    <button class="bg-white p-2 rounded-md shadow-sm border">Yardım</button>
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                             </div>
                        </div>
                        <div>
                             <h3 class="text-2xl font-bold mb-4 text-[#3D405B]">Bilgisayar Arayüzü Önizlemesi</h3>
                             <p class="text-gray-600 mb-6">Gelecekteki geliştirme aşamalarında bot için web tabanlı bir arayüz de planlanmaktadır. Bu arayüz, botun durumunu, bakiye ve pozisyon bilgilerini daha kapsamlı bir şekilde görselleştirecek bir dashboard sunacaktır.</p>
                             <div class="w-full max-w-2xl mx-auto bg-gray-200 rounded-lg p-2 shadow-2xl overflow-hidden">
                                <div class="bg-white rounded-md overflow-hidden flex flex-col h-[400px]">
                                    <!-- Header -->
                                    <div class="bg-gray-800 text-white p-3 flex items-center justify-between text-sm rounded-t-md">
                                        <div class="font-bold">Özer Binance Bot</div>
                                        <div class="flex gap-2">
                                            <span>&#x2500;</span>
                                            <span>&#x25A1;</span>
                                            <span>&#x2715;</span>
                                        </div>
                                    </div>
                                    <!-- Nav & Main Content -->
                                    <div class="flex flex-1">
                                        <!-- Sidebar Nav -->
                                        <nav class="w-32 bg-gray-100 p-4 border-r border-gray-200 flex flex-col gap-2 text-sm">
                                            <a href="#" class="block p-2 rounded-md hover:bg-gray-200 text-[#3D405B] font-medium">Ana Sayfa</a>
                                            <a href="#" class="block p-2 rounded-md hover:bg-gray-200 text-[#3D405B] font-medium">Sembol</a>
                                            <a href="#" class="block p-2 rounded-md hover:bg-gray-200 text-[#3D405B] font-medium">Pozisyon</a>
                                            <a href="#" class="block p-2 rounded-md hover:bg-gray-200 text-[#3D405B] font-medium">Cüzdan</a>
                                            <a href="#" class="block p-2 rounded-md hover:bg-gray-200 text-[#3D405B] font-medium">Ayarlar</a>
                                            <a href="#" class="block p-2 rounded-md hover:bg-gray-200 text-[#3D405B] font-medium">Loglar</a>
                                        </nav>
                                        <!-- Main Dashboard Area -->
                                        <div class="flex-1 p-6 bg-white overflow-y-auto">
                                            <h4 class="font-semibold text-xl mb-4 text-[#3D405B]">Ana Sayfa - Bot Durumu</h4>
                                            <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                                                <div class="bg-gray-50 p-4 rounded-lg shadow-sm border border-gray-100">
                                                    <p class="text-sm text-gray-500">Bot Durumu:</p>
                                                    <p class="font-bold text-lg text-green-600">Aktif</p>
                                                </div>
                                                <div class="bg-gray-50 p-4 rounded-lg shadow-sm border border-gray-100">
                                                    <p class="text-sm text-gray-500">Bakiye:</p>
                                                    <p class="font-bold text-lg text-[#3D405B]">1000 USDT</p>
                                                </div>
                                                <div class="bg-gray-50 p-4 rounded-lg shadow-sm border border-gray-100">
                                                    <p class="text-sm text-gray-500">Kazanç:</p>
                                                    <p class="font-bold text-lg text-green-500">+ 500 USDT</p>
                                                </div>
                                                <div class="bg-gray-50 p-4 rounded-lg shadow-sm border border-gray-100">
                                                    <p class="text-sm text-gray-500">Kar Oranı:</p>
                                                    <p class="font-bold text-lg text-green-500">+ %5</p>
                                                </div>
                                            </div>
                                            <div class="mt-6 flex flex-wrap gap-3">
                                                <button class="bg-[#81B29A] text-white py-2 px-4 rounded-md shadow-md hover:bg-[#6a9e82] text-sm">Bot Çalıştır</button>
                                                <button class="bg-[#E07A5F] text-white py-2 px-4 rounded-md shadow-md hover:bg-[#c2674e] text-sm">Bot Durdur</button>
                                                <button class="bg-[#F2CC8F] text-[#3D405B] py-2 px-4 rounded-md shadow-md hover:bg-[#e6bf85] text-sm">Sembol Düzenle</button>
                                                <button class="bg-gray-300 text-[#3D405B] py-2 px-4 rounded-md shadow-md hover:bg-gray-400 text-sm">Ayarları Düzenle</button>
                                            </div>
                                            <div class="mt-6 text-sm text-gray-700">
                                                <p class="font-bold">Loglar burada gözükecek...</p>
                                                <p>...</p>
                                            </div>
                                            <div class="mt-6 flex flex-wrap gap-3">
                                                <button class="bg-gray-300 text-[#3D405B] py-2 px-4 rounded-md shadow-md hover:bg-gray-400 text-sm">Hata Kayıtlarını İndir</button>
                                                <button class="bg-gray-300 text-[#3D405B] py-2 px-4 rounded-md shadow-md hover:bg-gray-400 text-sm">İşlem Kayıtlarını İndir</button>
                                            </div>
                                            <div class="mt-6">
                                                <button class="bg-blue-400 text-white py-2 px-4 rounded-md shadow-md hover:bg-blue-500 text-sm">Geliştiriciden Destek Al</button>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                             </div>
                        </div>
                    </div>
                 </section>
            </div>
        </main>
    </div>

    <script>
        document.addEventListener('DOMContentLoaded', function () {
            const tabs = document.querySelectorAll('.tab-button');
            const contents = document.querySelectorAll('.tab-content');
            const accordionItems = document.querySelectorAll('.accordion-item');

            tabs.forEach(tab => {
                tab.addEventListener('click', () => {
                    tabs.forEach(t => t.classList.remove('active'));
                    contents.forEach(c => c.classList.remove('active'));

                    tab.classList.add('active');
                    document.getElementById(tab.dataset.tab).classList.add('active');
                    
                    if(tab.dataset.tab === 'tab4') {
                        renderTasksChart();
                    }
                });
            });

            accordionItems.forEach(item => {
                const header = item.querySelector('.accordion-header');
                const content = item.querySelector('.accordion-content');
                const icon = header.querySelector('span:last-child');

                header.addEventListener('click', () => {
                    item.classList.toggle('active');
                    if (item.classList.contains('active')) {
                        content.style.maxHeight = content.scrollHeight + 'px';
                        icon.style.transform = 'rotate(180deg)';
                    } else {
                        content.style.maxHeight = '0px';
                         icon.style.transform = 'rotate(0deg)';
                    }
                });
            });
            
            let chartInstance = null;
            function renderTasksChart() {
                const ctx = document.getElementById('tasksChart').getContext('2d');
                const taskData = {
                    labels: ['Yapılan Çalışmalar', 'Yapılacak Çalışmalar', 'Altyapı & Entegrasyon', 'Çekirdek Mantık', 'Arayüz & Etkileşim', 'Veri & Güvenlik', 'Test & Optimizasyon', 'Dokümantasyon'],
                    datasets: [{
                        label: 'Görev Sayısı',
                        data: [2, 11, 5, 5, 4, 4, 4, 2], // Updated data values
                        backgroundColor: [
                            'rgba(129, 178, 154, 0.6)', // Yapılan Çalışmalar
                            'rgba(242, 204, 143, 0.6)', // Yapılacak Çalışmalar
                            'rgba(92, 133, 214, 0.6)',
                            'rgba(224, 122, 95, 0.6)',
                            'rgba(148, 148, 168, 0.6)',
                            'rgba(180, 190, 200, 0.6)',
                            'rgba(75, 192, 192, 0.6)', // New color for consistency
                            'rgba(153, 102, 255, 0.6)' // New color for consistency
                        ],
                        borderColor: [
                            '#81B29A',
                            '#F2CC8F',
                            '#5C85D6',
                            '#E07A5F',
                            '#9494A8',
                            '#B4BEC8',
                            '#4BC0C0',
                            '#9966FF'
                        ],
                        borderWidth: 2,
                        borderRadius: 5,
                    }]
                };

                if (chartInstance) {
                    chartInstance.destroy();
                }

                chartInstance = new Chart(ctx, {
                    type: 'bar',
                    data: taskData,
                    options: {
                        responsive: true,
                        maintainAspectRatio: false,
                        plugins: {
                            title: {
                                display: true,
                                text: 'Proje Görevlerinin Kategorilere Göre Dağılımı',
                                font: {
                                    size: 18,
                                    family: 'Inter, sans-serif'
                                },
                                color: '#3D405B',
                                padding: {
                                    bottom: 20
                                }
                            },
                            legend: {
                                display: false
                            }
                        },
                        scales: {
                            y: {
                                beginAtZero: true,
                                title: {
                                    display: true,
                                    text: 'Görev Sayısı'
                                },
                                ticks: {
                                    stepSize: 1
                                }
                            },
                            x: {
                                ticks: {
                                   font: {
                                       size: 11
                                   }
                                }
                            }
                        }
                    }
                });
            }

            // Initial render for the first active tab
            renderTasksChart();
        });
    </script>
</body>
</html>
